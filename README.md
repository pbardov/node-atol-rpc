# node-atol-rpc
## Описание
`node-atol-rpc` - это библиотека Node.js для взаимодействия с фискальными регистраторами АТОЛ через RPC (Remote Procedure Call). Библиотека предоставляет удобный JavaScript/TypeScript интерфейс для работы с кассовыми аппаратами АТОЛ, позволяя выполнять операции печати чеков, управления денежным ящиком и другие действия, необходимые для работы с ККТ.
## Установка
``` bash
npm install @pbardov/node-atol-rpc
```
или
``` bash
yarn add @pbardov/node-atol-rpc
```
## Использование
### Базовый пример
``` typescript
import AtolRpc from 'node-atol-rpc';

// Создание экземпляра класса для работы с ККТ
const atol = new AtolRpc({
  host: '127.0.0.1',  // IP-адрес кассы или localhost
  port: 50000         // Порт подключения к RPC-серверу АТОЛ
});

// Подключение к ККТ
await atol.connect();

// Пример открытия смены
await atol.openShift({
  cashierName: 'Иванов И.И.',
  cashierId: '1234'
});

// Пример печати чека
await atol.printReceipt({
  type: 'sell',  // Тип операции: продажа
  cashierName: 'Иванов И.И.',
  cashierId: '1234',
  items: [
    {
      name: 'Товар 1',
      price: 100.00,
      quantity: 2,
      amount: 200.00,
      tax: 'vat20'
    }
  ],
  payments: [
    {
      type: 'cash',
      amount: 200.00
    }
  ]
});

// Закрытие соединения
await atol.disconnect();
```
## Основные возможности
- Открытие/закрытие смены
- Печать чеков продажи, возврата, коррекции
- Внесение/выплата денег из кассы
- Печать X и Z отчетов
- Работа с денежным ящиком
- Получение информации о ККТ
- Печать копии последнего чека
- Поддержка маркированных товаров
- Поддержка дополнительных реквизитов

## API
Библиотека экспортирует следующие компоненты:
``` typescript
import AtolRpc, {AtolRpcBase, type Settings, isSettings} from 'node-atol-rpc';
```
- `AtolRpc` - основной класс для работы с АТОЛ ККТ
- `AtolRpcBase` - базовый класс с низкоуровневыми методами для взаимодействия с RPC-сервером
- `Settings` - тип конфигурации подключения
- `isSettings` - функция для проверки корректности настроек

### Настройки (Settings)
``` typescript
const settings: Settings = {
  host: '127.0.0.1',  // IP-адрес кассы (по умолчанию localhost)
  port: 50000,        // Порт RPC-сервера (по умолчанию 50000)
  timeout: 5000       // Таймаут операций в мс (по умолчанию 5000)
};
```
## Требования
- Node.js 14.x или выше
- Установленное и настроенное ПО АТОЛ (драйвер ККТ v.10 и выше)
- Доступ к RPC-серверу АТОЛ

## Лицензия
MIT
## Разработка и вклад в проект
Если вы хотите внести свой вклад в разработку библиотеки, пожалуйста, следуйте этим шагам:
1. Создайте форк репозитория
2. Создайте ветку для вашей функциональности (`git checkout -b feature/amazing-feature`)
3. Зафиксируйте ваши изменения (`git commit -m 'Add some amazing feature'`)
4. Отправьте изменения в ваш форк (`git push origin feature/amazing-feature`)
5. Откройте Pull Request

## Поддерживаемые модели ККТ
Библиотека поддерживает все модели ККТ АТОЛ, которые работают с драйвером ККТ v.10 и выше и имеют поддержку RPC-интерфейса.
