{
  "$id": "https://schemas.example.com/fptr10/json-task-request.schema.json",
  "$schema": "https://json-schema.org/draft/2020-12/schema",
  "title": "ATOL FPTR10 JSON Tasks — Request",
  "type": "object",
  "additionalProperties": false,
  "properties": {
    "type": {
      "type": "string"
    }
  },
  "required": ["type"],
  "oneOf": [
    { "$ref": "#/$defs/task.continuePrint" },

    { "$ref": "#/$defs/task.openShift" },
    { "$ref": "#/$defs/task.closeShift" },

    { "$ref": "#/$defs/task.sell" },
    { "$ref": "#/$defs/task.buy" },
    { "$ref": "#/$defs/task.sellReturn" },
    { "$ref": "#/$defs/task.buyReturn" },

    { "$ref": "#/$defs/task.sellCorrection" },
    { "$ref": "#/$defs/task.buyCorrection" },

    { "$ref": "#/$defs/task.nonFiscal" },

    { "$ref": "#/$defs/task.reportX" },
    { "$ref": "#/$defs/task.cashIn" },
    { "$ref": "#/$defs/task.cashOut" },
    { "$ref": "#/$defs/task.reportOfdExchangeStatus" },

    { "$ref": "#/$defs/task.printFnDocument" },
    { "$ref": "#/$defs/task.printLastReceiptCopy" },

    { "$ref": "#/$defs/task.getRegistrationInfo" },
    { "$ref": "#/$defs/task.registration" },
    { "$ref": "#/$defs/task.closeArchive" },

    { "$ref": "#/$defs/task.openCashDrawer" },
    { "$ref": "#/$defs/task.setDateTime" },

    { "$ref": "#/$defs/task.getDeviceParameters" },
    { "$ref": "#/$defs/task.setDeviceParameters" },

    { "$ref": "#/$defs/task.getDeviceInfo" },
    { "$ref": "#/$defs/task.getDeviceStatus" },
    { "$ref": "#/$defs/task.getCashDrawerStatus" },

    { "$ref": "#/$defs/task.getShiftStatus" },
    { "$ref": "#/$defs/task.getFnInfo" },
    { "$ref": "#/$defs/task.getFnStatus" },
    { "$ref": "#/$defs/task.ofdExchangeStatus" },

    { "$ref": "#/$defs/task.getShiftTotals" },
    { "$ref": "#/$defs/task.getOverallTotals" },

    { "$ref": "#/$defs/task.getFnDocument" },
    { "$ref": "#/$defs/task.getLicenses" },

    { "$ref": "#/$defs/task.printDocumentsFromJournal" }
  ],

  "$defs": {
    "operator": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "name": { "type": "string", "minLength": 1 },
        "vatin": { "type": "string" }
      },
      "required": ["name"]
    },

    "tax": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": {
          "type": "string",
          "enum": ["none", "vat0", "vat10", "vat20", "vat110", "vat120", "vat18", "vat118"]
        },
        "sum": { "type": "number" }
      },
      "required": ["type"]
    },

    "payment": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "type": "string", "enum": ["cash", "electronically", "prepaid", "credit", "other"] },
        "sum": { "type": "number" }
      },
      "required": ["type", "sum"]
    },

    "agentInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "agents": {
          "type": "array",
          "items": {
            "type": "string",
            "enum": [
              "bankPayingAgent",
              "bankPayingSubagent",
              "payingAgent",
              "payingSubagent",
              "commissionAgent",
              "attorney",
              "another"
            ]
          }
        },
        "payingAgent": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "operation": { "type": "string" },
            "phones": { "type": "array", "items": { "type": "string" } }
          }
        },
        "receivePaymentsOperator": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "phones": { "type": "array", "items": { "type": "string" } }
          }
        },
        "moneyTransferOperator": {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "phones": { "type": "array", "items": { "type": "string" } },
            "name": { "type": "string" },
            "address": { "type": "string" },
            "vatin": { "type": "string" }
          }
        }
      }
    },

    "supplierInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "phones": { "type": "array", "items": { "type": "string" } },
        "name": { "type": "string" },
        "vatin": { "type": "string" }
      }
    },

    "clientInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "emailOrPhone": { "type": "string" },
        "name": { "type": "string" }
      }
    },

    "companyInfo": {
      "type": "object",
      "additionalProperties": true
    },

    "nomenclatureCode": {
      "oneOf": [
        { "type": "string" },
        {
          "type": "object",
          "additionalProperties": false,
          "properties": {
            "type": { "type": "string", "enum": ["furs"] },
            "gtin": { "type": "string" },
            "serial": { "type": "string" }
          },
          "required": ["type", "gtin", "serial"]
        }
      ]
    },

    "printItem.text": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "text" },
        "text": { "type": "string" },
        "alignment": { "type": "string", "enum": ["left", "center", "right"] },
        "font": { "type": "integer", "minimum": 0 },
        "doubleWidth": { "type": "boolean" },
        "doubleHeight": { "type": "boolean" }
      },
      "required": ["type", "text"]
    },

    "printItem.barcode": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "barcode" },
        "barcode": { "type": "string" },
        "barcodeType": {
          "type": "string",
          "enum": [
            "EAN13", "EAN8", "UPCA", "UPCE",
            "CODE39", "CODE93", "CODE128",
            "ITF", "ITF14", "GS1_128",
            "QR", "PDF417", "AZTEC"
          ]
        },
        "scale": { "type": "integer", "minimum": 1 }
      },
      "required": ["type", "barcode"]
    },

    "printItem.pictureFromMemory": {
      "type": "object",
      "additionalProperties": true,
      "properties": {
        "type": { "const": "pictureFromMemory" }
      },
      "required": ["type"]
    },

    "printItem.userAttribute": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "userAttribute" },
        "name": { "type": "string" },
        "value": { "type": "string" },
        "print": { "type": "boolean" }
      },
      "required": ["type", "name", "value"]
    },

    "printItem.common": {
      "oneOf": [
        { "$ref": "#/$defs/printItem.text" },
        { "$ref": "#/$defs/printItem.barcode" },
        { "$ref": "#/$defs/printItem.pictureFromMemory" }
      ]
    },

    "printItem.noPicture": {
      "oneOf": [
        { "$ref": "#/$defs/printItem.text" },
        { "$ref": "#/$defs/printItem.barcode" }
      ]
    },

    "item.position": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "position" },
        "name": { "type": "string", "minLength": 1 },
        "price": { "type": "number" },
        "quantity": { "type": "number" },
        "amount": { "type": "number" },
        "infoDiscountAmount": { "type": "number" },
        "department": { "type": "integer", "minimum": 1 },
        "measurementUnit": { "type": "string" },
        "piece": { "type": "boolean" },
        "paymentMethod": {
          "type": "string",
          "enum": [
            "fullPrepayment", "prepayment", "advance",
            "fullPayment", "partialPayment",
            "credit", "creditPayment"
          ]
        },
        "paymentObject": { "type": "string" },
        "additionalAttribute": { "type": "string" },
        "nomenclatureCode": { "$ref": "#/$defs/nomenclatureCode" },
        "tax": { "$ref": "#/$defs/tax" },
        "agentInfo": { "$ref": "#/$defs/agentInfo" },
        "supplierInfo": { "$ref": "#/$defs/supplierInfo" }
      },
      "required": ["type", "name", "price", "quantity", "amount"]
    },

    "receiptItem": {
      "oneOf": [
        { "$ref": "#/$defs/item.position" },
        { "$ref": "#/$defs/printItem.text" },
        { "$ref": "#/$defs/printItem.barcode" },
        { "$ref": "#/$defs/printItem.pictureFromMemory" },
        { "$ref": "#/$defs/printItem.userAttribute" }
      ]
    },

    "receiptBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "taxationType": {
          "type": "string",
          "enum": ["osn", "usnIncome", "usnIncomeOutcome", "envd", "esn", "patent"]
        },
        "ignoreNonFiscalPrintErrors": { "type": "boolean" },
        "electronically": { "type": "boolean" },

        "operator": { "$ref": "#/$defs/operator" },
        "clientInfo": { "$ref": "#/$defs/clientInfo" },
        "companyInfo": { "$ref": "#/$defs/companyInfo" },
        "agentInfo": { "$ref": "#/$defs/agentInfo" },
        "supplierInfo": { "$ref": "#/$defs/supplierInfo" },

        "items": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/receiptItem" } },
        "payments": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/payment" } },
        "taxes": { "type": "array", "items": { "$ref": "#/$defs/tax" } },
        "total": { "type": "number" },

        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } }
      },
      "allOf": [
        {
          "if": { "properties": { "electronically": { "const": true } }, "required": ["electronically"] },
          "then": { "required": ["clientInfo"] }
        },
        {
          "if": { "properties": { "electronically": { "const": true } }, "required": ["electronically"] },
          "then": {
            "properties": {
              "clientInfo": {
                "type": "object",
                "required": ["emailOrPhone"]
              }
            }
          }
        }
      ],
      "required": ["taxationType", "operator", "items", "payments"]
    },

    "correctionBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "taxationType": {
          "type": "string",
          "enum": ["osn", "usnIncome", "usnIncomeOutcome", "envd", "esn", "patent"]
        },
        "ignoreNonFiscalPrintErrors": { "type": "boolean" },
        "electronically": { "type": "boolean" },

        "correctionType": { "type": "string", "enum": ["self", "instruction"] },
        "correctionBaseDate": { "type": "string" },
        "correctionBaseNumber": { "type": "string" },
        "correctionBaseName": { "type": "string" },

        "operator": { "$ref": "#/$defs/operator" },
        "clientInfo": { "$ref": "#/$defs/clientInfo" },

        "items": { "type": "array", "items": { "$ref": "#/$defs/receiptItem" } },
        "payments": { "type": "array", "items": { "$ref": "#/$defs/payment" } },
        "taxes": { "type": "array", "items": { "$ref": "#/$defs/tax" } },

        "total": { "type": "number" },

        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } }
      },
      "allOf": [
        {
          "if": { "properties": { "electronically": { "const": true } }, "required": ["electronically"] },
          "then": { "required": ["clientInfo"] }
        },
        {
          "if": { "properties": { "electronically": { "const": true } }, "required": ["electronically"] },
          "then": {
            "properties": {
              "clientInfo": {
                "type": "object",
                "required": ["emailOrPhone"]
              }
            }
          }
        }
      ],
      "required": ["taxationType", "operator", "correctionType"]
    },

    "cashInOutBase": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "operator": { "$ref": "#/$defs/operator" },
        "cashSum": { "type": "number" },
        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } }
      },
      "required": ["cashSum"]
    },

    "task.continuePrint": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "type": { "const": "continuePrint" } },
      "required": ["type"]
    },

    "task.openShift": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "openShift" },
        "operator": { "$ref": "#/$defs/operator" },
        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.noPicture" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.noPicture" } }
      },
      "required": ["type", "operator"]
    },

    "task.closeShift": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "closeShift" },
        "operator": { "$ref": "#/$defs/operator" },
        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } }
      },
      "required": ["type", "operator"]
    },

    "task.sell": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "sell" } }, "required": ["type"] },
        { "$ref": "#/$defs/receiptBase" }
      ]
    },
    "task.buy": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "buy" } }, "required": ["type"] },
        { "$ref": "#/$defs/receiptBase" }
      ]
    },
    "task.sellReturn": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "sellReturn" } }, "required": ["type"] },
        { "$ref": "#/$defs/receiptBase" }
      ]
    },
    "task.buyReturn": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "buyReturn" } }, "required": ["type"] },
        { "$ref": "#/$defs/receiptBase" }
      ]
    },

    "task.sellCorrection": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "sellCorrection" } }, "required": ["type"] },
        { "$ref": "#/$defs/correctionBase" }
      ]
    },
    "task.buyCorrection": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "buyCorrection" } }, "required": ["type"] },
        { "$ref": "#/$defs/correctionBase" }
      ]
    },

    "task.nonFiscal": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "nonFiscal" },
        "items": { "type": "array", "minItems": 1, "items": { "$ref": "#/$defs/printItem.common" } },
        "printFooter": { "type": "boolean" }
      },
      "required": ["type", "items"]
    },

    "task.reportX": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "reportX" },
        "operator": { "$ref": "#/$defs/operator" },
        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.common" } }
      },
      "required": ["type"]
    },

    "task.cashIn": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "cashIn" } }, "required": ["type"] },
        { "$ref": "#/$defs/cashInOutBase" }
      ]
    },

    "task.cashOut": {
      "allOf": [
        { "type": "object", "properties": { "type": { "const": "cashOut" } }, "required": ["type"] },
        { "$ref": "#/$defs/cashInOutBase" }
      ]
    },

    "task.reportOfdExchangeStatus": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "reportOfdExchangeStatus" },
        "operator": { "$ref": "#/$defs/operator" },
        "preItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.noPicture" } },
        "postItems": { "type": "array", "items": { "$ref": "#/$defs/printItem.noPicture" } }
      },
      "required": ["type"]
    },

    "task.printFnDocument": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "printFnDocument" },
        "fiscalDocumentNumber": { "type": "integer", "minimum": 1 }
      },
      "required": ["type", "fiscalDocumentNumber"]
    },

    "task.printLastReceiptCopy": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "type": { "const": "printLastReceiptCopy" } },
      "required": ["type"]
    },

    "task.getRegistrationInfo": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "type": { "const": "getRegistrationInfo" } },
      "required": ["type"]
    },

    "task.registration": {
      "description": "Регистрация/перерегистрация ККТ. Параметры зависят от ФФД и модели, допускается расширение.",
      "type": "object",
      "properties": {
        "type": { "const": "registration" }
      },
      "required": ["type"],
      "additionalProperties": true
    },

    "task.closeArchive": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "type": { "const": "closeArchive" } },
      "required": ["type"]
    },

    "task.openCashDrawer": {
      "type": "object",
      "additionalProperties": false,
      "properties": { "type": { "const": "openCashDrawer" } },
      "required": ["type"]
    },

    "task.setDateTime": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "setDateTime" },
        "dateTime": { "type": "string", "format": "date-time" }
      },
      "required": ["type", "dateTime"]
    },

    "task.getDeviceParameters": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "getDeviceParameters" },
        "keys": { "type": "array", "items": { "type": "integer" }, "minItems": 1, "uniqueItems": true }
      },
      "required": ["type", "keys"]
    },

    "task.setDeviceParameters": {
      "type": "object",
      "additionalProperties": false,
      "properties": {
        "type": { "const": "setDeviceParameters" },
        "deviceParameters": {
          "type": "array",
          "minItems": 1,
          "items": {
            "type": "object",
            "additionalProperties": false,
            "properties": {
              "key": { "type": "integer" },
              "value": { "type": "string" }
            },
            "required": ["key", "value"]
          }
        }
      },
      "required": ["type", "deviceParameters"]
    },

    "task.getDeviceInfo": {
      "type": "object",
      "properties": { "type": { "const": "getDeviceInfo" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getDeviceStatus": {
      "type": "object",
      "properties": { "type": { "const": "getDeviceStatus" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getCashDrawerStatus": {
      "type": "object",
      "properties": { "type": { "const": "getCashDrawerStatus" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getShiftStatus": {
      "type": "object",
      "properties": { "type": { "const": "getShiftStatus" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getFnInfo": {
      "type": "object",
      "properties": { "type": { "const": "getFnInfo" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getFnStatus": {
      "type": "object",
      "properties": { "type": { "const": "getFnStatus" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.ofdExchangeStatus": {
      "type": "object",
      "properties": { "type": { "const": "ofdExchangeStatus" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getShiftTotals": {
      "type": "object",
      "properties": { "type": { "const": "getShiftTotals" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getOverallTotals": {
      "type": "object",
      "properties": { "type": { "const": "getOverallTotals" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.getFnDocument": {
      "type": "object",
      "properties": {
        "type": { "const": "getFnDocument" },
        "fiscalDocumentNumber": { "type": "integer", "minimum": 1 },
        "short": { "type": "boolean" }
      },
      "required": ["type", "fiscalDocumentNumber"],
      "additionalProperties": false
    },

    "task.getLicenses": {
      "type": "object",
      "properties": { "type": { "const": "getLicenses" } },
      "required": ["type"],
      "additionalProperties": false
    },

    "task.printDocumentsFromJournal": {
      "description": "Вендорное расширение: печать документов из журнала драйвера.",
      "type": "object",
      "properties": {
        "type": { "const": "printDocumentsFromJournal" },
        "filter": {
          "type": "object",
          "oneOf": [
            {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "dateTimeRange": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "from": { "type": "string", "format": "date-time" },
                    "to": { "type": "string", "format": "date-time" }
                  },
                  "required": ["from", "to"]
                }
              },
              "required": ["dateTimeRange"]
            },
            {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "shiftRange": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "from": { "type": "integer", "minimum": 0 },
                    "to": { "type": "integer", "minimum": 0 }
                  },
                  "required": ["from", "to"]
                }
              },
              "required": ["shiftRange"]
            },
            {
              "type": "object",
              "additionalProperties": false,
              "properties": {
                "docNumberRange": {
                  "type": "object",
                  "additionalProperties": false,
                  "properties": {
                    "from": { "type": "integer", "minimum": 1 },
                    "to": { "type": "integer", "minimum": 1 }
                  },
                  "required": ["from", "to"]
                }
              },
              "required": ["docNumberRange"]
            }
          ]
        },
        "includeTypes": {
          "description": "Опциональный фильтр по типам документов журнала.",
          "type": "array",
          "items": { "type": "string" }
        }
      },
      "required": ["type"],
      "additionalProperties": true
    }
  }
}
